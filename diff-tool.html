<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數據差異比對神器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 自定義滾動條樣式 */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-800 font-sans">

    <nav class="bg-white border-b border-slate-200 px-6 py-3 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex items-center">
            <a href="index.html" class="flex items-center gap-2 text-slate-500 hover:text-slate-900 transition-colors text-sm font-medium">
                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                返回工具首頁
            </a>
        </div>
    </nav>

    <div class="p-4 md:p-8">
        <div class="max-w-7xl mx-auto space-y-6">
            
            <header class="flex flex-col md:flex-row justify-between items-center bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <div class="flex items-center gap-3 mb-4 md:mb-0">
                    <div class="bg-blue-600 p-2.5 rounded-lg text-white">
                        <i data-lucide="arrow-right-left"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-slate-900">數據差異比對神器</h1>
                        <p class="text-slate-500 text-sm">快速找出兩組數據的新增、刪除與共同項</p>
                    </div>
                </div>
                <button onclick="clearAll()" class="flex items-center gap-2 px-4 py-2 text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors text-sm font-medium">
                    <i data-lucide="trash-2" class="w-4 h-4"></i> 清空內容
                </button>
            </header>

            <div class="bg-white px-6 py-3 rounded-xl shadow-sm border border-slate-200 flex flex-wrap gap-4 items-center text-sm">
                <div class="flex items-center gap-2 text-slate-500">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                    <span class="font-semibold">設定：</span>
                </div>
                <label class="flex items-center gap-2 cursor-pointer hover:text-blue-600">
                    <input type="checkbox" id="ignoreCase" onchange="processData()" class="rounded border-slate-300 text-blue-600">
                    忽略大小寫
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:text-blue-600">
                    <input type="checkbox" id="trimWhitespace" checked onchange="processData()" class="rounded border-slate-300 text-blue-600">
                    自動去除空格
                </label>
                <div class="h-4 w-px bg-slate-200 mx-2 hidden md:block"></div>
                <div class="flex items-center gap-2">
                    <span class="text-slate-500">分隔符：</span>
                    <select id="delimiter" onchange="processData()" class="border-slate-300 rounded-lg text-sm py-1 pl-2 pr-6">
                        <option value="newline">換行</option>
                        <option value="comma">逗號 (CSV)</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="flex flex-col h-96">
                    <div class="flex justify-between items-center mb-2 px-1">
                        <label class="font-bold text-slate-700 flex items-center gap-2">
                            <span class="bg-slate-200 text-slate-600 text-xs px-2 py-0.5 rounded">舊數據</span> 數據組 A
                        </label>
                        <span id="countA" class="text-xs text-slate-400"></span>
                    </div>
                    <textarea id="inputA" oninput="processData()" placeholder="A001&#10;A002" class="flex-1 w-full p-4 rounded-xl border border-slate-300 focus:border-blue-500 outline-none font-mono text-sm resize-none"></textarea>
                </div>
                <div class="flex flex-col h-96">
                    <div class="flex justify-between items-center mb-2 px-1">
                        <label class="font-bold text-slate-700 flex items-center gap-2">
                            <span class="bg-blue-100 text-blue-700 text-xs px-2 py-0.5 rounded">新數據</span> 數據組 B
                        </label>
                        <span id="countB" class="text-xs text-slate-400"></span>
                    </div>
                    <textarea id="inputB" oninput="processData()" placeholder="A002&#10;A003" class="flex-1 w-full p-4 rounded-xl border border-slate-300 focus:border-blue-500 outline-none font-mono text-sm resize-none"></textarea>
                </div>
            </div>

            <div id="resultArea" class="grid grid-cols-1 md:grid-cols-3 gap-6 hidden">
                <div id="cardA" class="flex flex-col rounded-xl overflow-hidden border border-red-200 shadow-sm bg-white h-96"></div>
                <div id="cardB" class="flex flex-col rounded-xl overflow-hidden border border-green-200 shadow-sm bg-white h-96"></div>
                <div id="cardCommon" class="flex flex-col rounded-xl overflow-hidden border border-slate-200 shadow-sm bg-white h-96"></div>
            </div>

        </div>
    </div>

    <script>
        // 初始化圖示
        lucide.createIcons();

        function processData() {
            const inputA = document.getElementById('inputA').value;
            const inputB = document.getElementById('inputB').value;
            
            if (!inputA.trim() && !inputB.trim()) {
                document.getElementById('resultArea').classList.add('hidden');
                document.getElementById('countA').innerText = '';
                document.getElementById('countB').innerText = '';
                return;
            }

            const ignoreCase = document.getElementById('ignoreCase').checked;
            const trimWhitespace = document.getElementById('trimWhitespace').checked;
            const delimiterVal = document.getElementById('delimiter').value;
            const splitChar = delimiterVal === 'comma' ? ',' : '\n';

            const cleanLine = (line) => {
                let l = line;
                if (trimWhitespace) l = l.trim();
                if (ignoreCase) l = l.toLowerCase();
                return l;
            };

            const rawListA = inputA.split(splitChar).filter(l => l.trim() !== '');
            const rawListB = inputB.split(splitChar).filter(l => l.trim() !== '');

            document.getElementById('countA').innerText = `${rawListA.length} 條`;
            document.getElementById('countB').innerText = `${rawListB.length} 條`;

            // Sets for logic
            const setA_Normalized = new Set();
            const mapA_Original = new Map();
            rawListA.forEach(item => {
                const key = cleanLine(item);
                setA_Normalized.add(key);
                if (!mapA_Original.has(key)) mapA_Original.set(key, item);
            });

            const setB_Normalized = new Set();
            const mapB_Original = new Map();
            rawListB.forEach(item => {
                const key = cleanLine(item);
                setB_Normalized.add(key);
                if (!mapB_Original.has(key)) mapB_Original.set(key, item);
            });

            // Results
            const onlyInA = [];
            const onlyInB = [];
            const inBoth = [];

            mapA_Original.forEach((originalVal, key) => {
                if (!setB_Normalized.has(key)) onlyInA.push(originalVal);
                else inBoth.push(originalVal);
            });

            mapB_Original.forEach((originalVal, key) => {
                if (!setA_Normalized.has(key)) onlyInB.push(originalVal);
            });

            // Render
            document.getElementById('resultArea').classList.remove('hidden');
            renderCard('cardA', '只在 A (減少)', onlyInA, 'red', 'trash-2');
            renderCard('cardB', '只在 B (新增)', onlyInB, 'green', 'refresh-cw');
            renderCard('cardCommon', '相同數據 (交集)', inBoth, 'slate', 'check');
            
            // 重新渲染新生成的圖示
            lucide.createIcons(); 
        }

        function renderCard(elementId, title, data, color, iconName) {
            const colors = {
                red: { bg: 'bg-red-50', text: 'text-red-700', headerBg: 'bg-red-100', badge: 'bg-red-200 text-red-800', border: 'border-red-200', btn: 'bg-slate-800' },
                green: { bg: 'bg-green-50', text: 'text-green-700', headerBg: 'bg-green-100', badge: 'bg-green-200 text-green-800', border: 'border-green-200', btn: 'bg-slate-800' },
                slate: { bg: 'bg-slate-50', text: 'text-slate-700', headerBg: 'bg-slate-100', badge: 'bg-slate-200 text-slate-800', border: 'border-slate-200', btn: 'bg-slate-800' }
            };
            const c = colors[color];
            const listHtml = data.length > 0 
                ? `<ul class="divide-y divide-slate-100">${data.map(item => `<li class="px-4 py-2 text-sm text-slate-600 font-mono hover:bg-slate-50 break-all">${item}</li>`).join('')}</ul>`
                : `<div class="absolute inset-0 flex flex-col items-center justify-center text-slate-400 gap-2"><i data-lucide="info" class="opacity-20 w-8 h-8"></i><span class="text-sm">無數據</span></div>`;
            
            const html = `
                <div class="p-4 ${c.bg} border-b ${c.border} flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <div class="p-1.5 rounded-md ${c.headerBg} ${c.text}"><i data-lucide="${iconName}" class="w-4 h-4"></i></div>
                        <h3 class="font-bold ${c.text}">${title}</h3>
                    </div>
                    <span class="text-xs font-bold px-2 py-1 rounded-full ${c.badge}">${data.length}</span>
                </div>
                <div class="flex-1 overflow-y-auto bg-white relative">${listHtml}</div>
                <div class="p-3 border-t border-slate-100 bg-white">
                    <button onclick="copyData(this, '${encodeURIComponent(JSON.stringify(data))}')" ${data.length === 0 ? 'disabled' : ''} class="w-full flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-medium transition-all ${data.length === 0 ? 'bg-slate-100 text-slate-300 cursor-not-allowed' : 'bg-slate-800 text-white hover:bg-slate-700'}">
                        <i data-lucide="copy" class="w-4 h-4"></i> 複製結果
                    </button>
                </div>
            `;
            document.getElementById(elementId).innerHTML = html;
        }

        function clearAll() {
            document.getElementById('inputA').value = '';
            document.getElementById('inputB').value = '';
            processData();
        }

        function copyData(btn, dataStr) {
            const data = JSON.parse(decodeURIComponent(dataStr));
            const delimiter = document.getElementById('delimiter').value === 'comma' ? ',' : '\n';
            const text = data.join(delimiter);
            
            navigator.clipboard.writeText(text).then(() => {
                const originalHtml = btn.innerHTML;
                const originalClass = btn.className;
                
                btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i> 已複製`;
                btn.classList.remove('bg-slate-800', 'hover:bg-slate-700');
                btn.classList.add('bg-green-600', 'hover:bg-green-600');
                lucide.createIcons();

                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.className = originalClass;
                    lucide.createIcons();
                }, 2000);
            });
        }
    </script>
</body>
</html>